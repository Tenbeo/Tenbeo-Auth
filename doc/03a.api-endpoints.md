

# Tenbeo Auth API

### Tenbeo Auth Application

First, you need to create a **Tenbeo Auth Application** in the Admin Panel to allow new users to connect.
Define an app slug and allow the domain names of your web-application, otherwise you will have CORS blocking your requests. 


### About Cors

**CORS** is used to allow only specific web-applications to use **Tenbeo Login** APIs.
Any non authorized domain will be refused for security purpose.
The session ID of the connecting user is tied to the allowed domains in a cookie.


# Endpoints


### GET - `/api/1.0/create/{app-slug}`
#### Origin : <u>browser only</u>

Call this API from the front-end of your application to create a new Tenbeo Login QR-Code.
This will attach a new session, and register it with a cookie on the client.

Only users which subscribes to the **Tenbeo Auth Application** ( app-slug param ) will be able to connect. 

#### Return : <u>json</u>
```ts
{
  session: {
	// PENDING if user has not connected with Tenbeo Mobile App
	// VALIDATED if user is already connected
	status : "PENDING" | "VALIDATED",
	// The created or retrieved session ID 
	id : string,
  },
  // If user is already connected
  user : {
	id : number,
	name : string,
	email ?: string,
	data ?: object,
  },
  // If user is not already connected
  login : {
	// Base64 image of the validate command in a QR-Code
	// <img src={ response.login.qr } /> will show it
	qr : string,
	// URL of the validate command for this session
	// Useful if you want to implement your own QR Code
	url : string
  }
}
```

When called, a cookie with the session ID is created on the user's computer.

> If user is already logged, `login` will be omitted from the return.
> The front-end can check for `session.status === "VALIDATED"` to redirect to the secured area.  

If you need to force session recreation, `?force-recreation` will logout any connected user, and return a new session.

> If QR-Code changes each time the `create` endpoint is called, check that the fetch send credentials. It surely means that session cookie is not sent to the API and cannot keep connection steady.


---
### GET - `/api/1.0/track/{app-slug}`
#### Origin : <u>browser only</u>

Call this API from the front-end, to check if the user has logged.

#### Return : <u>json</u>
```ts
{
  session : {
	status : "PENDING" | "VALIDATED" | "EXPIRED",
	id : string
  },
  // User object is present if session is validated
  user ?: {
	id : number,
	name : string,
	email ?: string,
	data ?: object,
  },
}
```

> **app-slug** parameter has to be sent because users can have 1 session by app.


---
### POST - `/api/1.0/verify-session/{session-id}`
#### Origin : <u>backend only</u>

Call this API from your backend to verify the status of a session.
If you need to verify which user is connected, and if the session is valid, send the session ID from your front-end to your API with a header. In your back-end you will be able to validate access to certain resources.

#### Return : <u>json</u>
```ts
{
	session		: {
		status : "PENDING" | "VALIDATED" | "EXPIRED"
	},
	// If user is connected
	user ?: {
		id : number,
		name : string,
		email ?: string,
		data ?: object,
	},
	// You can double check if the ap in session is the correct one
	app : {
		slug : string
	}
	// If user subscribes to the app tied to the session
	subscribes : boolean
}
```

---
### POST - `/api/1.0/logout/{app-slug}`

#### Origin : <u>browser only</u>

Will log out the user, destroy the session and remove the cookie.

---
### POST - `/api/1.0/validate/{session-id}`

#### Origin : <u>Tenbeo Mobile App</u>

Is called by the **Tenbeo Mobile App** when user has connected.
This is the URL generated by the `create` endpoint in the QR-Code.

---
### GET - `/api/1.0/validate/{session-id}`

#### Origin : <u>browser only</u>

Is used to redirect the user when the QR-Code is scanned with the camera app and not the **Tenbeo Mobile App**.
The link can be defined by the envs. By default it downloads the **Tenbeo Mobile App**.